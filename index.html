<form id="bookingForm">
  <input type="text" name="name" placeholder="Name" required>
  <input type="tel" name="phone" placeholder="Phone" required>
  <input type="email" name="email" placeholder="Email">
  <input type="text" name="bike_type" placeholder="Bike Type" required>
  <select name="service" required>
    <option value="">Select Service</option>
    <option value="basic">Basic Clean</option>
    <option value="premium">Premium Detail</option>
  </select>
  <input type="date" name="date" required>
  <input type="time" name="time" required>
  <textarea name="notes" placeholder="Additional notes"></textarea>
  
  <button type="submit">Book Now</button>
</form>

<script>
// ⚠️ REPLACE THIS WITH YOUR NEW DEPLOYMENT URL AFTER REDEPLOYING
const scriptURL = "https://script.google.com/macros/s/AKfycbwXfRBlpVuvBIOzpaKYMfpUn7eykKs4Op3WKF0kCGp9UNwDAnQR-PvsWDROPBewy-TA/exec";

document.getElementById("bookingForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  
  const submitButton = e.target.querySelector('button[type="submit"]');
  const originalText = submitButton.textContent;
  
  // Show loading state
  submitButton.textContent = "Submitting...";
  submitButton.disabled = true;

  try {
    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());

    console.log("Submitting data:", data);

    const response = await fetch(scriptURL, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json" 
      },
      body: JSON.stringify(data)
    });

    // Check if response is OK
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const result = await response.json();
    console.log("Server response:", result);
    
    if (result.status === "success") {
      alert("✅ Booking submitted successfully!");
      this.reset();
    } else if (result.error) {
      throw new Error(result.message || "Server error occurred");
    } else {
      throw new Error("Unexpected response from server");
    }

  } catch (error) {
    console.error("Full error details:", error);
    
    // More specific error messages
    if (error.message.includes("Failed to fetch")) {
      alert("❌ Cannot connect to server. Please:\n• Check your internet connection\n• Verify the script URL is correct\n• Ensure Google Apps Script is properly deployed");
    } else if (error.message.includes("HTTP error")) {
      alert("❌ Server error: " + error.message);
    } else {
      alert("❌ Error: " + error.message);
    }
  } finally {
    // Reset button state
    submitButton.textContent = originalText;
    submitButton.disabled = false;
  }
});
</script>
